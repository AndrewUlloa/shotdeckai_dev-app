# Cloudflare Worker for ShotDeckAI Multi-Tier Image System
name = "shotdeck-image-cache"
main = "src/index.ts"
compatibility_date = "2024-09-27"
compatibility_flags = ["nodejs_compat"]

# Using your correct account ID  
account_id = "427699ca78bfbbfa80d62636b0d962c0"

# KV namespace for caching image metadata
[[kv_namespaces]]
binding = "IMAGE_CACHE"
preview_id = "3a2e2b9bdb0d4be3b182c0a6ef10711a"
id = "0bee46597d0f4ad697d0040789273d2c"

# Default environment variables (production)
[vars]
# Enhanced Logging for Multi-Tier System
LOG_LEVEL = "info"
ENABLE_REQUEST_LOGGING = "false"    # Reduced for production
ENABLE_PERFORMANCE_LOGGING = "true"
ENABLE_TIER_TRACKING = "true"

# Multi-Tier Configuration
ENABLE_INSTANT_TIER = "true"
ENABLE_FAST_TIER = "true"
ENABLE_FINAL_TIER = "true"
ENABLE_BACKGROUND_GENERATION = "true"

# Semantic Cache Configuration
ENABLE_SEMANTIC_CACHE = "true"
SEMANTIC_EXPANSION_COUNT = "6"
PREDICTION_ACCURACY_THRESHOLD = "0.4"

# Performance Thresholds (milliseconds)
INSTANT_TIER_TIMEOUT = "200"
FAST_TIER_TIMEOUT = "2000"
FINAL_TIER_TIMEOUT = "5000"

# Quality Settings
FAST_TIER_INFERENCE_STEPS = "4"
FINAL_TIER_INFERENCE_STEPS = "8"
SEMANTIC_CONFIDENCE_THRESHOLD = "0.70"

# Enhanced observability for multi-tier monitoring
[observability.logs]
enabled = true
invocation_logs = true

# Development environment with full logging
[env.dev]
[[env.dev.kv_namespaces]]
binding = "IMAGE_CACHE"
preview_id = "3a2e2b9bdb0d4be3b182c0a6ef10711a"
id = "0bee46597d0f4ad697d0040789273d2c"

[env.dev.vars]
LOG_LEVEL = "debug"
ENABLE_REQUEST_LOGGING = "true"
ENABLE_PERFORMANCE_LOGGING = "true"
ENABLE_TIER_TRACKING = "true"
ENABLE_INSTANT_TIER = "true"
ENABLE_FAST_TIER = "true"
ENABLE_FINAL_TIER = "true"
ENABLE_BACKGROUND_GENERATION = "true"
ENABLE_SEMANTIC_CACHE = "true"
SEMANTIC_EXPANSION_COUNT = "6"
PREDICTION_ACCURACY_THRESHOLD = "0.4"
INSTANT_TIER_TIMEOUT = "200"
FAST_TIER_TIMEOUT = "2000"
FINAL_TIER_TIMEOUT = "5000"
FAST_TIER_INFERENCE_STEPS = "4"
FINAL_TIER_INFERENCE_STEPS = "8"
SEMANTIC_CONFIDENCE_THRESHOLD = "0.70"

# Production environment with optimized settings
[env.production]
[[env.production.kv_namespaces]]
binding = "IMAGE_CACHE"
preview_id = "3a2e2b9bdb0d4be3b182c0a6ef10711a"
id = "0bee46597d0f4ad697d0040789273d2c"

[env.production.vars]
LOG_LEVEL = "info"
ENABLE_REQUEST_LOGGING = "false"
ENABLE_PERFORMANCE_LOGGING = "true"
ENABLE_TIER_TRACKING = "true"
ENABLE_INSTANT_TIER = "true"
ENABLE_FAST_TIER = "true"
ENABLE_FINAL_TIER = "true"
ENABLE_BACKGROUND_GENERATION = "true"
ENABLE_SEMANTIC_CACHE = "true"
SEMANTIC_EXPANSION_COUNT = "6"
PREDICTION_ACCURACY_THRESHOLD = "0.4"
INSTANT_TIER_TIMEOUT = "200"
FAST_TIER_TIMEOUT = "2000"
FINAL_TIER_TIMEOUT = "5000"
FAST_TIER_INFERENCE_STEPS = "4"
FINAL_TIER_INFERENCE_STEPS = "8"
SEMANTIC_CONFIDENCE_THRESHOLD = "0.70"
